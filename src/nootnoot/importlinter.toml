[importlinter]
  root_package = "nootnoot"

  #
  # 1. Layering: cli -> app -> core
  #
  [[importlinter.contracts]]
    name = "Enforce nootnoot layering (cli -> app -> core)"
    type = "layers"
    layers = [
      "nootnoot.cli",
      "nootnoot.app",
      "nootnoot.core",
    ]

  #
  # 2. CLI must not depend on core directly (must go through app)
  #
  [[importlinter.contracts]]
    name              = "CLI must not import core directly"
    type              = "forbidden"
    source_modules    = ["nootnoot.cli"]
    forbidden_modules = ["nootnoot.core"]

  #
  # 3. Core must be pure (no app/cli, no heavy side-effectful deps)
  #
  [[importlinter.contracts]]
    name = "Core must be pure"
    type = "forbidden"
    source_modules = ["nootnoot.core"]
    forbidden_modules = [
      "nootnoot.app",
      "nootnoot.cli",
      "os",
      "sys",
      "multiprocessing",
      "pytest",
      "coverage",
    ]

  #
  # 4. Limit intra-app coupling (protect heavyweight mutation module)
  #
  [[importlinter.contracts]]
    name = "Limit intra-app coupling"
    type = "forbidden"
    source_modules = [
      "nootnoot.app.code_coverage",
      "nootnoot.app.meta",
      "nootnoot.app.persistence",
      "nootnoot.app.reporting",
      "nootnoot.app.runners",
    ]
    forbidden_modules = [
      "nootnoot.app.mutation",
    ]

  #
  # 5. Prevent sensitive app cycles (state must remain low-level)
  #
  [[importlinter.contracts]]
    name              = "No cycles between app state and runners"
    type              = "forbidden"
    source_modules    = ["nootnoot.app.state"]
    forbidden_modules = ["nootnoot.app.runners"]

  #
  # 6. CLI isolation: only entrypoints may import cli
  #
  [[importlinter.contracts]]
    name = "CLI is only imported by entrypoints"
    type = "forbidden"
    source_modules = ["nootnoot"]
    forbidden_modules = ["nootnoot.cli"]
    ignore_imports = [
      "nootnoot.__main__ -> nootnoot.cli",
    ]

  #
  # 7. (Optional strictness) No relative imports across packages
  #
  [[importlinter.contracts]]
    name              = "No cross-package relative imports"
    type              = "forbidden"
    forbidden_modules = [".."]
